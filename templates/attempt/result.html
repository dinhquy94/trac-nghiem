{% extends "base.html" %}

{% block title %}Káº¿t quáº£ thi - {{ exam.title }}{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto;">
    <h1 style="color: white; text-align: center; margin-bottom: 2rem;">
        {% if attempt.passed %}ğŸ‰{% else %}ğŸ“Š{% endif %} Káº¿t quáº£ thi
    </h1>
    
    <div class="card text-center">
        <h2 style="color: #333; margin-bottom: 1rem;">{{ exam.title }}</h2>
        
        <div style="background: {% if attempt.passed %}#d4edda{% else %}#f8d7da{% endif %}; padding: 2rem; border-radius: 12px; margin: 2rem 0;">
            <div style="font-size: 3rem; font-weight: bold; color: {% if attempt.passed %}#155724{% else %}#721c24{% endif %}; margin-bottom: 0.5rem;">
                {{ attempt.percentage }}%
            </div>
            <div style="font-size: 1.2rem; color: {% if attempt.passed %}#155724{% else %}#721c24{% endif %};">
                {{ attempt.score }}/{{ attempt.max_score }} Ä‘iá»ƒm
            </div>
            <div style="font-size: 1.5rem; font-weight: bold; margin-top: 1rem;">
                {% if attempt.passed %}
                    <span style="color: #28a745;">âœ… Äáº T</span>
                {% else %}
                    <span style="color: #dc3545;">âŒ KHÃ”NG Äáº T</span>
                {% endif %}
            </div>
        </div>
        
        <div class="grid grid-3" style="text-align: left;">
            <div>
                <strong>Thá»i gian lÃ m bÃ i:</strong>
                <p>{{ (attempt.submitted_at - attempt.started_at).total_seconds() // 60 }} phÃºt</p>
            </div>
            <div>
                <strong>Äiá»ƒm Ä‘áº¡t yÃªu cáº§u:</strong>
                <p>{{ exam.passing_score }}%</p>
            </div>
            <div>
                <strong>Sá»‘ cÃ¢u Ä‘Ãºng:</strong>
                {% if attempt.max_score > 0 %}
                <p>{{ (attempt.score / attempt.max_score * questions|length)|round|int }} / {{ questions|length }}</p>
                {% else %}
                <p>0 / 0 (khÃ´ng cÃ³ cÃ¢u há»i)</p>
                {% endif %}
            </div>
        </div>
        
        {% if student %}
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e0e0e0;">
            <strong>Há»c sinh:</strong> {{ student.username }}
        </div>
        {% endif %}
    </div>
    
    <div class="card mt-3">
        <h3 class="card-header">ğŸ“ Chi tiáº¿t bÃ i lÃ m</h3>
        
        {% if questions|length > 0 %}
        {% for question in questions %}
        <div style="padding: 1.5rem; border-bottom: 1px solid #e0e0e0;">
            <div class="d-flex justify-between align-center mb-2">
                <strong style="color: #333;">CÃ¢u {{ loop.index }}: {{ question.question_text }}</strong>
                <div class="d-flex gap-1">
                    <span class="badge badge-info">{{ question.points }} Ä‘iá»ƒm</span>
                    {% set student_answer = attempt.answers.get(question._id|string, '') %}
                    {% set is_correct = student_answer.strip().upper() == question.correct_answer.strip().upper() %}
                    {% if question.question_type in ['multiple_choice', 'true_false'] %}
                        {% if is_correct %}
                            <span class="badge badge-success">âœ“ ÄÃºng</span>
                        {% else %}
                            <span class="badge badge-danger">âœ— Sai</span>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            
            {% if question.question_type == 'multiple_choice' %}
            <div style="margin-left: 1rem; margin-top: 1rem;">
                {% for option in question.options %}
                {% set is_student_choice = option.startswith(student_answer) %}
                {% set is_correct_option = option.startswith(question.correct_answer) %}
                <div style="padding: 0.5rem; margin: 0.25rem 0; border-radius: 4px; 
                    background: {% if is_correct_option %}#d4edda{% elif is_student_choice %}#f8d7da{% else %}white{% endif %};
                    border: 2px solid {% if is_correct_option %}#28a745{% elif is_student_choice %}#dc3545{% else %}#e0e0e0{% endif %};">
                    {{ option }}
                    {% if is_correct_option %}<strong style="color: #28a745;"> â† ÄÃ¡p Ã¡n Ä‘Ãºng</strong>{% endif %}
                    {% if is_student_choice and not is_correct_option %}<strong style="color: #dc3545;"> â† Báº¡n chá»n</strong>{% endif %}
                </div>
                {% endfor %}
            </div>
            {% if exam.exam_type == 'practice' and question.explanation %}
            <div class="alert alert-info mt-2" style="background: #e7f3ff; border-left: 4px solid #2196f3; padding: 1rem; margin-left: 1rem; margin-top: 1rem;">
                <strong>ğŸ’¡ Giáº£i thÃ­ch:</strong> {{ question.explanation }}
            </div>
            {% endif %}
            {% elif question.question_type == 'true_false' %}
            <div style="margin-left: 1rem; margin-top: 1rem;">
                <div style="padding: 0.5rem; margin: 0.25rem 0; border-radius: 4px; 
                    background: {% if question.correct_answer == 'ÄÃºng' %}#d4edda{% elif student_answer == 'ÄÃºng' %}#f8d7da{% else %}white{% endif %};
                    border: 2px solid {% if question.correct_answer == 'ÄÃºng' %}#28a745{% elif student_answer == 'ÄÃºng' %}#dc3545{% else %}#e0e0e0{% endif %};">
                    A. ÄÃºng
                    {% if question.correct_answer == 'ÄÃºng' %}<strong style="color: #28a745;"> â† ÄÃ¡p Ã¡n Ä‘Ãºng</strong>{% endif %}
                    {% if student_answer == 'ÄÃºng' and question.correct_answer != 'ÄÃºng' %}<strong style="color: #dc3545;"> â† Báº¡n chá»n</strong>{% endif %}
                </div>
                <div style="padding: 0.5rem; margin: 0.25rem 0; border-radius: 4px; 
                    background: {% if question.correct_answer == 'Sai' %}#d4edda{% elif student_answer == 'Sai' %}#f8d7da{% else %}white{% endif %};
                    border: 2px solid {% if question.correct_answer == 'Sai' %}#28a745{% elif student_answer == 'Sai' %}#dc3545{% else %}#e0e0e0{% endif %};">
                    B. Sai
                    {% if question.correct_answer == 'Sai' %}<strong style="color: #28a745;"> â† ÄÃ¡p Ã¡n Ä‘Ãºng</strong>{% endif %}
                    {% if student_answer == 'Sai' and question.correct_answer != 'Sai' %}<strong style="color: #dc3545;"> â† Báº¡n chá»n</strong>{% endif %}
                </div>
            </div>
            {% if exam.exam_type == 'practice' and question.explanation %}
            <div class="alert alert-info mt-2" style="background: #e7f3ff; border-left: 4px solid #2196f3; padding: 1rem; margin-left: 1rem; margin-top: 1rem;">
                <strong>ğŸ’¡ Giáº£i thÃ­ch:</strong> {{ question.explanation }}
            </div>
            {% endif %}
            {% elif question.question_type == 'essay' %}
            <div style="margin-top: 1rem;">
                <strong>CÃ¢u tráº£ lá»i cá»§a báº¡n:</strong>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-top: 0.5rem;">
                    {{ student_answer }}
                </div>
                {% if question.correct_answer %}
                <div style="margin-top: 1rem;">
                    <strong>Gá»£i Ã½ Ä‘Ã¡p Ã¡n:</strong>
                    <div style="background: #d4edda; padding: 1rem; border-radius: 4px; margin-top: 0.5rem;">
                        {{ question.correct_answer }}
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
        {% else %}
        <div style="padding: 2rem; text-align: center; color: #999;">
            <p>ğŸ“­ Äá» thi nÃ y khÃ´ng cÃ³ cÃ¢u há»i</p>
        </div>
        {% endif %}
    </div>
    
    <div class="text-center mt-3">
        <a href="{{ url_for('main.student_dashboard') }}" class="btn btn-primary">â¬…ï¸ Vá» Dashboard</a>
        <a href="{{ url_for('exam.list_exams') }}" class="btn btn-secondary">ğŸ“ Xem Ä‘á» thi khÃ¡c</a>
    </div>
</div>
{% endblock %}
